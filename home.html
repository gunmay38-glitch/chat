<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini WhatsApp Clone</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>

  <style>
    * { box-sizing: border-box; font-family: Arial, sans-serif; }
    body { margin: 0; background: #ece5dd; }

    .auth, .chat { max-width: 500px; margin: auto; height: 100vh; background: #fff; display: none; flex-direction: column; }

    .auth { padding: 20px; }
    input, button { padding: 10px; margin: 8px 0; width: 100%; }

    header { background: #075e54; color: white; padding: 12px; text-align: center; }

    .messages { flex: 1; padding: 10px; overflow-y: auto; }
    .msg { margin: 6px 0; padding: 8px; border-radius: 8px; max-width: 75%; }
    .me { background: #dcf8c6; margin-left: auto; }
    .other { background: #f1f0f0; }
    .time { font-size: 10px; color: #555; text-align: right; }

    footer { display: flex; padding: 8px; border-top: 1px solid #ddd; }
    footer input { flex: 1; }

    @media (max-width: 600px) {
      .auth, .chat { max-width: 100%; }
    }
  </style>
</head>
<body>

<div class="auth" id="auth">
  <h2>Register / Login</h2>
  <input id="username" placeholder="Username" />
  <input id="password" type="password" placeholder="Password" />
  <button onclick="register()">Register</button>
  <button onclick="login()">Login</button>
</div>

<div class="chat" id="chat">
  <header id="chatHeader">Chat</header>
  <input id="chatUser" placeholder="Chat with username" />
  <div class="messages" id="messages"></div>
  <footer>
    <input id="messageInput" placeholder="Type a message" />
    <button onclick="sendMessage()">Send</button>
  </footer>
</div>

<script>
  // ðŸ”¥ Firebase config (REPLACE with your own)
  const firebaseConfig = {
    apiKey: "AIzaSyAaXRb6M7siNeQI1OAy1W9DULuuDDX8CDg",
    authDomain: "chat-4b38b.firebaseapp.com",
    projectId: "chat-4b38b",
    storageBucket: "chat-4b38b.firebasestorage.app",
    messagingSenderId: "656059272540",
    appId: "1:656059272540:web:0d5ec37ab2ca12c145c599",
    measurementId: "G-Q0MND4DPFN"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const authDiv = document.getElementById('auth');
  const chatDiv = document.getElementById('chat');
  const messagesDiv = document.getElementById('messages');

  let currentUser;
  let unsubscribe;

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user.email.split('@')[0];
      authDiv.style.display = 'none';
      chatDiv.style.display = 'flex';
    } else {
      authDiv.style.display = 'block';
      chatDiv.style.display = 'none';
    }
  });

  function register() {
    const u = username.value;
    const p = password.value;
    auth.createUserWithEmailAndPassword(u + '@chat.com', p);
  }

  function login() {
    const u = username.value;
    const p = password.value;
    auth.signInWithEmailAndPassword(u + '@chat.com', p);
  }

  function sendMessage() {
    const to = chatUser.value;
    const text = messageInput.value;
    if (!to || !text) return;

    db.collection('messages').add({
      from: currentUser,
      to,
      text,
      time: firebase.firestore.FieldValue.serverTimestamp(),
      seen: false
    });

    messageInput.value = '';
  }

  chatUser.addEventListener('change', () => {
    if (unsubscribe) unsubscribe();

    unsubscribe = db.collection('messages')
      .where('from', 'in', [currentUser, chatUser.value])
      .where('to', 'in', [currentUser, chatUser.value])
      .orderBy('time')
      .onSnapshot(snapshot => {
        messagesDiv.innerHTML = '';
        snapshot.forEach(doc => {
          const m = doc.data();
          const div = document.createElement('div');
          div.className = 'msg ' + (m.from === currentUser ? 'me' : 'other');
          div.innerHTML = `<b>${m.from}</b><br>${m.text}<div class="time">${m.time?.toDate().toLocaleTimeString()} ${m.seen ? 'âœ“âœ“' : 'âœ“'}</div>`;
          messagesDiv.appendChild(div);

          if (m.to === currentUser && !m.seen) {
            doc.ref.update({ seen: true });
          }
        });
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      });
  });
</script>
</body>
</html>
